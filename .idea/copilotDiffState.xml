<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/flask_app.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/flask_app.py" />
              <option name="originalContent" value="from flask import Flask, render_template, redirect, url_for, request, flash, session, jsonify&#10;from peewee import OperationalError&#10;from waitress import serve&#10;&#10;from model import Job, JobToListing, Listing, SearchTerm, User, BlacklistTerm&#10;from sites.indeed import Indeed&#10;from sites.jora import Jora&#10;from sites.linkedin import LinkedIn&#10;from sites.seek import Seek&#10;&#10;app = Flask(__name__)&#10;app.secret_key = &quot;job_search_secret_key&quot;  # For flash messages&#10;&#10;&#10;# Helper to get current username from session&#10;def get_current_username():&#10;    username = session.get(&quot;username&quot;)&#10;    if not username:&#10;        return None&#10;    return username&#10;&#10;&#10;# Route to select/set username&#10;@app.route(&quot;/set_username&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])&#10;def set_username():&#10;    usernames = [u.username for u in User.select().order_by(User.username)]&#10;    if request.method == &quot;POST&quot;:&#10;        username = request.form.get(&quot;username&quot;)&#10;        if username and username in usernames:&#10;            session[&quot;username&quot;] = username&#10;            flash(f&quot;Username set to {username}&quot;)&#10;            return redirect(url_for(&quot;index&quot;))&#10;        else:&#10;            flash(&quot;Please select a valid username.&quot;)&#10;    return render_template(&quot;set_username.html&quot;, usernames=usernames)&#10;&#10;&#10;# Decorator to require username selection&#10;from functools import wraps&#10;&#10;&#10;def require_username(f):&#10;    @wraps(f)&#10;    def decorated_function(*args, **kwargs):&#10;        if not get_current_username():&#10;            return redirect(url_for(&quot;set_username&quot;))&#10;        return f(*args, **kwargs)&#10;&#10;    return decorated_function&#10;&#10;&#10;@app.route(&quot;/&quot;)&#10;@require_username&#10;def index():&#10;    &quot;&quot;&quot;Main page with workflow stages&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    triage_count = -1&#10;    while triage_count &lt; 0:&#10;        try:&#10;            triage_count = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).count()&#10;            reading_count = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).count()&#10;            applying_count = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).count()&#10;        except OperationalError:&#10;            print(&quot;Database error&quot;)&#10;&#10;    return render_template(&#10;        &quot;index.html&quot;,&#10;        triage_count=triage_count,&#10;        reading_count=reading_count,&#10;        applying_count=applying_count,&#10;        username=username,&#10;    )&#10;&#10;&#10;@app.route(&quot;/triage&quot;)&#10;@require_username&#10;def triage():&#10;    &quot;&quot;&quot;Triage page for new jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to triage&#10;    job = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to triage!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    return render_template(&quot;triage.html&quot;, job=job, listings=listings, username=username)&#10;&#10;&#10;@app.route(&quot;/triage/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def triage_action():&#10;    &quot;&quot;&quot;Handle triage actions (yes/no/undo)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    if action == &quot;interested&quot;:&#10;        job.status = &quot;interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for further review&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Skipped '{job.title}'&quot;)&#10;    elif action == &quot;undo&quot;:&#10;        # Get the most recently updated job that's not new&#10;        prev_job = (&#10;            Job.select().where((Job.status != &quot;new&quot;) &amp; (Job.username == username)).order_by(Job.id.desc()).first()&#10;        )&#10;        if prev_job:&#10;            prev_job.status = &quot;new&quot;&#10;            prev_job.save()&#10;            flash(f&quot;Undid action for '{prev_job.title}'&quot;)&#10;&#10;    return redirect(url_for(&quot;triage&quot;))&#10;&#10;&#10;@app.route(&quot;/reading&quot;)&#10;@require_username&#10;def reading():&#10;    &quot;&quot;&quot;Reading page for interested jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to read&#10;    job = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to read!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;reading.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/reading/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def reading_action():&#10;    &quot;&quot;&quot;Handle reading actions (like/dislike)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    if action == &quot;liked&quot;:&#10;        job.status = &quot;liked&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for application&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' as not a good fit&quot;)&#10;&#10;    return redirect(url_for(&quot;reading&quot;))&#10;&#10;&#10;@app.route(&quot;/applying&quot;)&#10;@require_username&#10;def applying():&#10;    &quot;&quot;&quot;Applying page for liked jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to apply for&#10;    job = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to apply for!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;applying.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/applying/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def applying_action():&#10;    &quot;&quot;&quot;Handle applying actions (status update)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    status = request.form.get(&quot;status&quot;)&#10;&#10;    if not job_id or not status:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;applying&quot;))&#10;&#10;    job = Job.get_by_id(job_id)&#10;    job.status = status&#10;    job.save()&#10;    if status == &quot;applied&quot;:&#10;        flash(f&quot;Marked '{job.title}' as application submitted&quot;)&#10;    elif status == &quot;not_interested&quot;:&#10;        flash(f&quot;Marked '{job.title}' as not pursuing&quot;)&#10;    else:&#10;        flash(f&quot;Updated status for '{job.title}' to {status}&quot;)&#10;&#10;    return redirect(url_for(&quot;applying&quot;))&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;GET&quot;])&#10;@require_username&#10;def get_search_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    terms = [st.term for st in SearchTerm.select().where(SearchTerm.user == user)]&#10;    return jsonify(terms)&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def add_search_term():&#10;    term = request.form.get(&quot;term&quot;)&#10;    if not term:&#10;        return jsonify({&quot;error&quot;: &quot;No term provided&quot;}), 400&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    try:&#10;        SearchTerm.create(term=term, user=user)&#10;        return jsonify({&quot;success&quot;: True})&#10;    except Exception as e:&#10;        return jsonify({&quot;error&quot;: str(e)}), 400&#10;&#10;&#10;@app.route(&quot;/search_terms/&lt;term&gt;&quot;, methods=[&quot;DELETE&quot;])&#10;@require_username&#10;def delete_search_term(term):&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    q = SearchTerm.delete().where((SearchTerm.term == term) &amp; (SearchTerm.user == user))&#10;    deleted = q.execute()&#10;    return jsonify({&quot;deleted&quot;: deleted})&#10;&#10;&#10;@app.route(&quot;/manage_search_terms&quot;)&#10;@require_username&#10;def manage_search_terms():&#10;    return render_template(&quot;manage_search_terms.html&quot;)&#10;&#10;&#10;@app.route(&quot;/blacklist_terms&quot;, methods=[&quot;GET&quot;])&#10;@require_username&#10;def get_blacklist_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    terms = [bt.term for bt in BlacklistTerm.select().where(BlacklistTerm.user == user)]&#10;    return jsonify(terms)&#10;&#10;&#10;@app.route(&quot;/blacklist_terms&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def add_blacklist_term():&#10;    term = request.form.get(&quot;term&quot;)&#10;    if not term:&#10;        return jsonify({&quot;error&quot;: &quot;No term provided&quot;}), 400&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    try:&#10;        BlacklistTerm.create(term=term, user=user)&#10;        return jsonify({&quot;success&quot;: True})&#10;    except Exception as e:&#10;        return jsonify({&quot;error&quot;: str(e)}), 400&#10;&#10;&#10;@app.route(&quot;/blacklist_terms/&lt;term&gt;&quot;, methods=[&quot;DELETE&quot;])&#10;@require_username&#10;def delete_blacklist_term(term):&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    q = BlacklistTerm.delete().where((BlacklistTerm.term == term) &amp; (BlacklistTerm.user == user))&#10;    deleted = q.execute()&#10;    return jsonify({&quot;deleted&quot;: deleted})&#10;&#10;&#10;@app.route(&quot;/manage_blacklist_terms&quot;)&#10;@require_username&#10;def manage_blacklist_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    return render_template(&quot;manage_blacklist_terms.html&quot;, user_id=user.id)&#10;&#10;&#10;@app.route(&quot;/run_easy_filter&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def run_easy_filter():&#10;    data = request.get_json()&#10;    user_id = data.get(&quot;user_id&quot;)&#10;    if not user_id:&#10;        return jsonify({&quot;error&quot;: &quot;No user_id provided&quot;}), 400&#10;    user = User.get_or_none(User.id == user_id)&#10;    if not user:&#10;        return jsonify({&quot;error&quot;: &quot;User not found&quot;}), 404&#10;    # Get blacklist terms for this user&#10;    blacklist_terms = [bl.term for bl in BlacklistTerm.select().where(BlacklistTerm.user == user)]&#10;    # Get new jobs for this user&#10;    new_jobs = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == user.username))&#10;    filtered_count = 0&#10;    for term in blacklist_terms:&#10;        for job in new_jobs:&#10;            if term.lower() in job.title.lower():&#10;                job.status = &quot;easy_filter&quot;&#10;                job.save()&#10;                filtered_count += 1&#10;    return jsonify({&quot;message&quot;: f&quot;Easy filter run for {user.username}. {filtered_count} jobs filtered.&quot;})&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    serve(app, host=&quot;0.0.0.0&quot;, port=80)&#10;" />
              <option name="updatedContent" value="from flask import Flask, render_template, redirect, url_for, request, flash, session, jsonify&#10;from peewee import OperationalError&#10;from waitress import serve&#10;&#10;from model import Job, JobToListing, Listing, SearchTerm, User, BlacklistTerm&#10;from sites.indeed import Indeed&#10;from sites.jora import Jora&#10;from sites.linkedin import LinkedIn&#10;from sites.seek import Seek&#10;&#10;app = Flask(__name__)&#10;app.secret_key = &quot;job_search_secret_key&quot;  # For flash messages&#10;&#10;&#10;# Helper to get current username from session&#10;def get_current_username():&#10;    username = session.get(&quot;username&quot;)&#10;    if not username:&#10;        return None&#10;    return username&#10;&#10;&#10;# Route to select/set username&#10;@app.route(&quot;/set_username&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])&#10;def set_username():&#10;    usernames = [u.username for u in User.select().order_by(User.username)]&#10;    if request.method == &quot;POST&quot;:&#10;        username = request.form.get(&quot;username&quot;)&#10;        if username and username in usernames:&#10;            session[&quot;username&quot;] = username&#10;            flash(f&quot;Username set to {username}&quot;)&#10;            return redirect(url_for(&quot;index&quot;))&#10;        else:&#10;            flash(&quot;Please select a valid username.&quot;)&#10;    return render_template(&quot;set_username.html&quot;, usernames=usernames)&#10;&#10;&#10;# Decorator to require username selection&#10;from functools import wraps&#10;&#10;&#10;def require_username(f):&#10;    @wraps(f)&#10;    def decorated_function(*args, **kwargs):&#10;        if not get_current_username():&#10;            return redirect(url_for(&quot;set_username&quot;))&#10;        return f(*args, **kwargs)&#10;&#10;    return decorated_function&#10;&#10;&#10;@app.route(&quot;/&quot;)&#10;@require_username&#10;def index():&#10;    &quot;&quot;&quot;Main page with workflow stages&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    triage_count = -1&#10;    while triage_count &lt; 0:&#10;        try:&#10;            triage_count = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).count()&#10;            reading_count = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).count()&#10;            applying_count = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).count()&#10;        except OperationalError:&#10;            print(&quot;Database error&quot;)&#10;&#10;    return render_template(&#10;        &quot;index.html&quot;,&#10;        triage_count=triage_count,&#10;        reading_count=reading_count,&#10;        applying_count=applying_count,&#10;        username=username,&#10;    )&#10;&#10;&#10;@app.route(&quot;/triage&quot;)&#10;@require_username&#10;def triage():&#10;    &quot;&quot;&quot;Triage page for new jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to triage&#10;    job = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to triage!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    return render_template(&quot;triage.html&quot;, job=job, listings=listings, username=username)&#10;&#10;&#10;@app.route(&quot;/triage/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def triage_action():&#10;    &quot;&quot;&quot;Handle triage actions (yes/no/undo)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    if action == &quot;interested&quot;:&#10;        job.status = &quot;interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for further review&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Skipped '{job.title}'&quot;)&#10;    elif action == &quot;undo&quot;:&#10;        # Get the most recently updated job that's not new&#10;        prev_job = (&#10;            Job.select().where((Job.status != &quot;new&quot;) &amp; (Job.username == username)).order_by(Job.id.desc()).first()&#10;        )&#10;        if prev_job:&#10;            prev_job.status = &quot;new&quot;&#10;            prev_job.save()&#10;            flash(f&quot;Undid action for '{prev_job.title}'&quot;)&#10;&#10;    return redirect(url_for(&quot;triage&quot;))&#10;&#10;&#10;@app.route(&quot;/reading&quot;)&#10;@require_username&#10;def reading():&#10;    &quot;&quot;&quot;Reading page for interested jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to read&#10;    job = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to read!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;reading.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/reading/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def reading_action():&#10;    &quot;&quot;&quot;Handle reading actions (like/dislike)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    if action == &quot;liked&quot;:&#10;        job.status = &quot;liked&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for application&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' as not a good fit&quot;)&#10;&#10;    return redirect(url_for(&quot;reading&quot;))&#10;&#10;&#10;@app.route(&quot;/applying&quot;)&#10;@require_username&#10;def applying():&#10;    &quot;&quot;&quot;Applying page for liked jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to apply for&#10;    job = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to apply for!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;applying.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/applying/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def applying_action():&#10;    &quot;&quot;&quot;Handle applying actions (status update)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    status = request.form.get(&quot;status&quot;)&#10;&#10;    if not job_id or not status:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;applying&quot;))&#10;&#10;    job = Job.get_by_id(job_id)&#10;    job.status = status&#10;    job.save()&#10;    if status == &quot;applied&quot;:&#10;        flash(f&quot;Marked '{job.title}' as application submitted&quot;)&#10;    elif status == &quot;not_interested&quot;:&#10;        flash(f&quot;Marked '{job.title}' as not pursuing&quot;)&#10;    else:&#10;        flash(f&quot;Updated status for '{job.title}' to {status}&quot;)&#10;&#10;    return redirect(url_for(&quot;applying&quot;))&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;GET&quot;])&#10;@require_username&#10;def get_search_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    terms = [st.term for st in SearchTerm.select().where(SearchTerm.user == user)]&#10;    return jsonify(terms)&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def add_search_term():&#10;    term = request.form.get(&quot;term&quot;)&#10;    if not term:&#10;        return jsonify({&quot;error&quot;: &quot;No term provided&quot;}), 400&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    try:&#10;        SearchTerm.create(term=term, user=user)&#10;        return jsonify({&quot;success&quot;: True})&#10;    except Exception as e:&#10;        return jsonify({&quot;error&quot;: str(e)}), 400&#10;&#10;&#10;@app.route(&quot;/search_terms/&lt;term&gt;&quot;, methods=[&quot;DELETE&quot;])&#10;@require_username&#10;def delete_search_term(term):&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    q = SearchTerm.delete().where((SearchTerm.term == term) &amp; (SearchTerm.user == user))&#10;    deleted = q.execute()&#10;    return jsonify({&quot;deleted&quot;: deleted})&#10;&#10;&#10;@app.route(&quot;/manage_search_terms&quot;)&#10;@require_username&#10;def manage_search_terms():&#10;    return render_template(&quot;manage_search_terms.html&quot;)&#10;&#10;&#10;@app.route(&quot;/blacklist_terms&quot;, methods=[&quot;GET&quot;])&#10;@require_username&#10;def get_blacklist_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    terms = [bt.term for bt in BlacklistTerm.select().where(BlacklistTerm.user == user)]&#10;    return jsonify(terms)&#10;&#10;&#10;@app.route(&quot;/blacklist_terms&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def add_blacklist_term():&#10;    term = request.form.get(&quot;term&quot;)&#10;    if not term:&#10;        return jsonify({&quot;error&quot;: &quot;No term provided&quot;}), 400&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    try:&#10;        BlacklistTerm.create(term=term, user=user)&#10;        return jsonify({&quot;success&quot;: True})&#10;    except Exception as e:&#10;        return jsonify({&quot;error&quot;: str(e)}), 400&#10;&#10;&#10;@app.route(&quot;/blacklist_terms/&lt;term&gt;&quot;, methods=[&quot;DELETE&quot;])&#10;@require_username&#10;def delete_blacklist_term(term):&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    q = BlacklistTerm.delete().where((BlacklistTerm.term == term) &amp; (BlacklistTerm.user == user))&#10;    deleted = q.execute()&#10;    return jsonify({&quot;deleted&quot;: deleted})&#10;&#10;&#10;@app.route(&quot;/manage_blacklist_terms&quot;)&#10;@require_username&#10;def manage_blacklist_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    return render_template(&quot;manage_blacklist_terms.html&quot;, user_id=user.id)&#10;&#10;&#10;@app.route(&quot;/run_easy_filter&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def run_easy_filter():&#10;    data = request.get_json()&#10;    user_id = data.get(&quot;user_id&quot;)&#10;    if not user_id:&#10;        return jsonify({&quot;error&quot;: &quot;No user_id provided&quot;}), 400&#10;    user = User.get_or_none(User.id == user_id)&#10;    if not user:&#10;        return jsonify({&quot;error&quot;: &quot;User not found&quot;}), 404&#10;    # Get blacklist terms for this user&#10;    blacklist_terms = [bl.term for bl in BlacklistTerm.select().where(BlacklistTerm.user == user)]&#10;    # Get new jobs for this user&#10;    new_jobs = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == user.username))&#10;    filtered_count = 0&#10;    for term in blacklist_terms:&#10;        for job in new_jobs:&#10;            if term.lower() in job.title.lower():&#10;                job.status = &quot;easy_filter&quot;&#10;                job.save()&#10;                filtered_count += 1&#10;    return jsonify({&quot;message&quot;: f&quot;Easy filter run for {user.username}. {filtered_count} jobs filtered.&quot;})&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    serve(app, host=&quot;0.0.0.0&quot;, port=80)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/templates/manage_blacklist_terms.html">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/templates/manage_blacklist_terms.html" />
              <option name="originalContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;title&gt;Manage Blacklist Terms&lt;/title&gt;&#10;    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/style.css&quot;&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    {% extends &quot;base.html&quot; %}&#10;    {% block content %}&#10;    &lt;div class=&quot;card search-terms-card&quot;&gt;&#10;        &lt;h2&gt;Manage Blacklist Terms&lt;/h2&gt;&#10;        &lt;form id=&quot;add-term-form&quot; class=&quot;add-term-form&quot;&gt;&#10;            &lt;input type=&quot;text&quot; id=&quot;new-term&quot; class=&quot;term-input&quot; placeholder=&quot;Add new blacklist term&quot; required&gt;&#10;            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;Add&lt;/button&gt;&#10;        &lt;/form&gt;&#10;        &lt;ul id=&quot;terms-list&quot; class=&quot;terms-list&quot;&gt;&lt;/ul&gt;&#10;        &lt;button id=&quot;run-easy-filter&quot; class=&quot;btn btn-primary&quot; style=&quot;margin-top: 16px;&quot;&gt;Run Easy Filter&lt;/button&gt;&#10;    &lt;/div&gt;&#10;    &lt;script&gt;&#10;    function fetchTerms() {&#10;        fetch('/blacklist_terms')&#10;            .then(response =&gt; response.json())&#10;            .then(terms =&gt; {&#10;                const list = document.getElementById('terms-list');&#10;                list.innerHTML = '';&#10;                terms.forEach(term =&gt; {&#10;                    const li = document.createElement('li');&#10;                    li.className = 'term-list-item';&#10;                    const span = document.createElement('span');&#10;                    span.textContent = term;&#10;                    li.appendChild(span);&#10;                    const delBtn = document.createElement('button');&#10;                    delBtn.textContent = 'Delete';&#10;                    delBtn.className = 'btn btn-danger btn-delete';&#10;                    delBtn.onclick = () =&gt; deleteTerm(term);&#10;                    li.appendChild(delBtn);&#10;                    list.appendChild(li);&#10;                });&#10;            });&#10;    }&#10;    function addTerm(e) {&#10;        e.preventDefault();&#10;        const term = document.getElementById('new-term').value;&#10;        fetch('/blacklist_terms', {&#10;            method: 'POST',&#10;            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },&#10;            body: 'term=' + encodeURIComponent(term)&#10;        })&#10;        .then(() =&gt; {&#10;            document.getElementById('new-term').value = '';&#10;            fetchTerms();&#10;        });&#10;    }&#10;    function deleteTerm(term) {&#10;        fetch('/blacklist_terms/' + encodeURIComponent(term), { method: 'DELETE' })&#10;            .then(() =&gt; fetchTerms());&#10;    }&#10;    document.getElementById('add-term-form').addEventListener('submit', addTerm);&#10;    window.onload = fetchTerms;&#10;&#10;    document.getElementById('run-easy-filter').onclick = function() {&#10;        fetch('/run_easy_filter', {&#10;            method: 'POST',&#10;            headers: {&#10;                'Content-Type': 'application/json'&#10;            },&#10;            body: JSON.stringify({ user_id: {{ user_id }} })&#10;        })&#10;        .then(response =&gt; response.json())&#10;        .then(data =&gt; {&#10;            alert(data.message || 'Easy filter run!');&#10;        });&#10;    };&#10;    &lt;/script&gt;&#10;    {% endblock %}&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;title&gt;Manage Blacklist Terms&lt;/title&gt;&#10;    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/style.css&quot;&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    {% extends &quot;base.html&quot; %}&#10;    {% block content %}&#10;    &lt;div class=&quot;card search-terms-card&quot;&gt;&#10;        &lt;h2&gt;Manage Blacklist Terms&lt;/h2&gt;&#10;        &lt;form id=&quot;add-term-form&quot; class=&quot;add-term-form&quot;&gt;&#10;            &lt;input type=&quot;text&quot; id=&quot;new-term&quot; class=&quot;term-input&quot; placeholder=&quot;Add new blacklist term&quot; required&gt;&#10;            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;Add&lt;/button&gt;&#10;        &lt;/form&gt;&#10;        &lt;ul id=&quot;terms-list&quot; class=&quot;terms-list&quot;&gt;&lt;/ul&gt;&#10;        &lt;button id=&quot;run-easy-filter&quot; class=&quot;btn btn-primary&quot; style=&quot;margin-top: 16px;&quot;&gt;Run Easy Filter&lt;/button&gt;&#10;    &lt;/div&gt;&#10;    &lt;script&gt;&#10;    function fetchTerms() {&#10;        fetch('/blacklist_terms')&#10;            .then(response =&gt; response.json())&#10;            .then(terms =&gt; {&#10;                const list = document.getElementById('terms-list');&#10;                list.innerHTML = '';&#10;                terms.forEach(term =&gt; {&#10;                    const li = document.createElement('li');&#10;                    li.className = 'term-list-item';&#10;                    const span = document.createElement('span');&#10;                    span.textContent = term;&#10;                    li.appendChild(span);&#10;                    const delBtn = document.createElement('button');&#10;                    delBtn.textContent = 'Delete';&#10;                    delBtn.className = 'btn btn-danger btn-delete';&#10;                    delBtn.onclick = () =&gt; deleteTerm(term);&#10;                    li.appendChild(delBtn);&#10;                    list.appendChild(li);&#10;                });&#10;            });&#10;    }&#10;    function addTerm(e) {&#10;        e.preventDefault();&#10;        const term = document.getElementById('new-term').value;&#10;        fetch('/blacklist_terms', {&#10;            method: 'POST',&#10;            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },&#10;            body: 'term=' + encodeURIComponent(term)&#10;        })&#10;        .then(() =&gt; {&#10;            document.getElementById('new-term').value = '';&#10;            fetchTerms();&#10;        });&#10;    }&#10;    function deleteTerm(term) {&#10;        fetch('/blacklist_terms/' + encodeURIComponent(term), { method: 'DELETE' })&#10;            .then(() =&gt; fetchTerms());&#10;    }&#10;    document.getElementById('add-term-form').addEventListener('submit', addTerm);&#10;    window.onload = fetchTerms;&#10;&#10;    document.getElementById('run-easy-filter').onclick = function() {&#10;        fetch('/run_easy_filter', {&#10;            method: 'POST',&#10;            headers: {&#10;                'Content-Type': 'application/json'&#10;            },&#10;            body: JSON.stringify({ user_id: {{ user_id }} })&#10;        })&#10;        .then(response =&gt; response.json())&#10;        .then(data =&gt; {&#10;            alert(data.message || 'Easy filter run!');&#10;        });&#10;    };&#10;    &lt;/script&gt;&#10;    {% endblock %}&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>