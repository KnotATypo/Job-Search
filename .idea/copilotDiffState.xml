<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/download.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/download.py" />
              <option name="originalContent" value="import json&#10;import os&#10;from typing import List, Tuple&#10;&#10;from tqdm import tqdm&#10;&#10;from model import Job, SearchTerm&#10;from sites.indeed import Indeed&#10;from sites.jora import Jora&#10;from sites.linkedin import LinkedIn&#10;from sites.seek import Seek&#10;from sites.site import JobType, Site&#10;&#10;&#10;def main():&#10;    # Fetch search terms from the database as objects&#10;    search_terms = list(SearchTerm.select())&#10;    sites = [Indeed()]&#10;&#10;    for site in tqdm(sites, desc=&quot;Sites&quot;, unit=&quot;site&quot;):&#10;        for st in tqdm(search_terms, desc=&quot;Terms&quot;, unit=&quot;term&quot;, leave=False):&#10;            # Pass both the term and the username to the site download method&#10;            site.download_new_listings(st.term, st.user.username)&#10;&#10;    # easy_filter(blacklist_terms)&#10;&#10;&#10;def easy_filter(blacklist_terms: List[str]):&#10;    new_jobs = Job.select().where(Job.status == &quot;new&quot;)&#10;    for term in blacklist_terms:&#10;        for job in new_jobs:&#10;            if term.lower() in job.title.lower():&#10;                job.status = &quot;easy_filter&quot;&#10;                job.save()&#10;&#10;&#10;def load_config() -&gt; Tuple[List[str], List[str], List[Site], List[JobType]]:&#10;    root_path = os.path.realpath(__file__)[: os.path.realpath(__file__).rindex(&quot;Job-Search&quot;) + 10]&#10;    with open(f&quot;{root_path}/config/config.json&quot;, &quot;r&quot;) as f:&#10;        config = json.load(f)&#10;&#10;    sites = []&#10;    for site in config[&quot;sites&quot;]:&#10;        match site:&#10;            case &quot;indeed&quot;:&#10;                sites.append(Indeed())&#10;            case &quot;jora&quot;:&#10;                sites.append(Jora())&#10;            case &quot;seek&quot;:&#10;                sites.append(Seek())&#10;            case &quot;linkedin&quot;:&#10;                sites.append(LinkedIn())&#10;&#10;    types = []&#10;    for type in config[&quot;types&quot;]:&#10;        match type:&#10;            case &quot;full&quot;:&#10;                types.append(JobType.FULL)&#10;            case &quot;part&quot;:&#10;                types.append(JobType.PART)&#10;            case &quot;casual&quot;:&#10;                types.append(JobType.CASUAL)&#10;&#10;    return config[&quot;search-terms&quot;], config[&quot;title-blacklist&quot;], sites, types&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    main()&#10;" />
              <option name="updatedContent" value="import json&#10;import os&#10;from typing import List, Tuple&#10;&#10;from tqdm import tqdm&#10;&#10;from model import Job, SearchTerm&#10;from sites.indeed import Indeed&#10;from sites.jora import Jora&#10;from sites.linkedin import LinkedIn&#10;from sites.seek import Seek&#10;from sites.site import JobType, Site&#10;&#10;&#10;def main():&#10;    # Fetch search terms from the database as objects&#10;    search_terms = list(SearchTerm.select())&#10;    sites = [Indeed()]&#10;&#10;    for site in tqdm(sites, desc=&quot;Sites&quot;, unit=&quot;site&quot;):&#10;        for st in tqdm(search_terms, desc=&quot;Terms&quot;, unit=&quot;term&quot;, leave=False):&#10;            # Pass both the term and the username to the site download method&#10;            site.download_new_listings(st.term, st.user.username)&#10;&#10;    # easy_filter(blacklist_terms)&#10;&#10;&#10;def easy_filter(blacklist_terms: List[str]):&#10;    new_jobs = Job.select().where(Job.status == &quot;new&quot;)&#10;    for term in blacklist_terms:&#10;        for job in new_jobs:&#10;            if term.lower() in job.title.lower():&#10;                job.status = &quot;easy_filter&quot;&#10;                job.save()&#10;&#10;&#10;def load_config() -&gt; Tuple[List[str], List[str], List[Site], List[JobType]]:&#10;    root_path = os.path.realpath(__file__)[: os.path.realpath(__file__).rindex(&quot;Job-Search&quot;) + 10]&#10;    with open(f&quot;{root_path}/config/config.json&quot;, &quot;r&quot;) as f:&#10;        config = json.load(f)&#10;&#10;    sites = []&#10;    for site in config[&quot;sites&quot;]:&#10;        match site:&#10;            case &quot;indeed&quot;:&#10;                sites.append(Indeed())&#10;            case &quot;jora&quot;:&#10;                sites.append(Jora())&#10;            case &quot;seek&quot;:&#10;                sites.append(Seek())&#10;            case &quot;linkedin&quot;:&#10;                sites.append(LinkedIn())&#10;&#10;    types = []&#10;    for type in config[&quot;types&quot;]:&#10;        match type:&#10;            case &quot;full&quot;:&#10;                types.append(JobType.FULL)&#10;            case &quot;part&quot;:&#10;                types.append(JobType.PART)&#10;            case &quot;casual&quot;:&#10;                types.append(JobType.CASUAL)&#10;&#10;    return config[&quot;search-terms&quot;], config[&quot;title-blacklist&quot;], sites, types&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    main()" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/flask_app.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/flask_app.py" />
              <option name="originalContent" value="from flask import Flask, render_template, redirect, url_for, request, flash, session, jsonify&#10;from peewee import OperationalError&#10;from waitress import serve&#10;&#10;from model import Job, JobToListing, Listing, SearchTerm, User&#10;from sites.indeed import Indeed&#10;from sites.jora import Jora&#10;from sites.linkedin import LinkedIn&#10;from sites.seek import Seek&#10;&#10;app = Flask(__name__)&#10;app.secret_key = &quot;job_search_secret_key&quot;  # For flash messages&#10;&#10;&#10;# Helper to get current username from session&#10;def get_current_username():&#10;    username = session.get(&quot;username&quot;)&#10;    if not username:&#10;        return None&#10;    return username&#10;&#10;&#10;# Route to select/set username&#10;@app.route(&quot;/set_username&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])&#10;def set_username():&#10;    usernames = [u.username for u in User.select().order_by(User.username)]&#10;    if request.method == &quot;POST&quot;:&#10;        username = request.form.get(&quot;username&quot;)&#10;        if username and username in usernames:&#10;            session[&quot;username&quot;] = username&#10;            flash(f&quot;Username set to {username}&quot;)&#10;            return redirect(url_for(&quot;index&quot;))&#10;        else:&#10;            flash(&quot;Please select a valid username.&quot;)&#10;    return render_template(&quot;set_username.html&quot;, usernames=usernames)&#10;&#10;&#10;# Decorator to require username selection&#10;from functools import wraps&#10;&#10;&#10;def require_username(f):&#10;    @wraps(f)&#10;    def decorated_function(*args, **kwargs):&#10;        if not get_current_username():&#10;            return redirect(url_for(&quot;set_username&quot;))&#10;        return f(*args, **kwargs)&#10;&#10;    return decorated_function&#10;&#10;&#10;@app.route(&quot;/&quot;)&#10;@require_username&#10;def index():&#10;    &quot;&quot;&quot;Main page with workflow stages&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    triage_count = -1&#10;    while triage_count &lt; 0:&#10;        try:&#10;            triage_count = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).count()&#10;            reading_count = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).count()&#10;            applying_count = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).count()&#10;        except OperationalError:&#10;            print(&quot;Database error&quot;)&#10;&#10;    return render_template(&#10;        &quot;index.html&quot;,&#10;        triage_count=triage_count,&#10;        reading_count=reading_count,&#10;        applying_count=applying_count,&#10;        username=username,&#10;    )&#10;&#10;&#10;@app.route(&quot;/triage&quot;)&#10;@require_username&#10;def triage():&#10;    &quot;&quot;&quot;Triage page for new jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to triage&#10;    job = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to triage!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    return render_template(&quot;triage.html&quot;, job=job, listings=listings, username=username)&#10;&#10;&#10;@app.route(&quot;/triage/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def triage_action():&#10;    &quot;&quot;&quot;Handle triage actions (yes/no/undo)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    if action == &quot;interested&quot;:&#10;        job.status = &quot;interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for further review&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Skipped '{job.title}'&quot;)&#10;    elif action == &quot;undo&quot;:&#10;        # Get the most recently updated job that's not new&#10;        prev_job = (&#10;            Job.select().where((Job.status != &quot;new&quot;) &amp; (Job.username == username)).order_by(Job.id.desc()).first()&#10;        )&#10;        if prev_job:&#10;            prev_job.status = &quot;new&quot;&#10;            prev_job.save()&#10;            flash(f&quot;Undid action for '{prev_job.title}'&quot;)&#10;&#10;    return redirect(url_for(&quot;triage&quot;))&#10;&#10;&#10;@app.route(&quot;/reading&quot;)&#10;@require_username&#10;def reading():&#10;    &quot;&quot;&quot;Reading page for interested jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to read&#10;    job = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to read!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;reading.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/reading/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def reading_action():&#10;    &quot;&quot;&quot;Handle reading actions (like/dislike)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    if action == &quot;liked&quot;:&#10;        job.status = &quot;liked&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for application&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' as not a good fit&quot;)&#10;&#10;    return redirect(url_for(&quot;reading&quot;))&#10;&#10;&#10;@app.route(&quot;/applying&quot;)&#10;@require_username&#10;def applying():&#10;    &quot;&quot;&quot;Applying page for liked jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to apply for&#10;    job = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to apply for!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;applying.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/applying/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def applying_action():&#10;    &quot;&quot;&quot;Handle applying actions (status update)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    status = request.form.get(&quot;status&quot;)&#10;&#10;    if not job_id or not status:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;applying&quot;))&#10;&#10;    job = Job.get_by_id(job_id)&#10;    job.status = status&#10;    job.save()&#10;    if status == &quot;applied&quot;:&#10;        flash(f&quot;Marked '{job.title}' as application submitted&quot;)&#10;    elif status == &quot;not_interested&quot;:&#10;        flash(f&quot;Marked '{job.title}' as not pursuing&quot;)&#10;    else:&#10;        flash(f&quot;Updated status for '{job.title}' to {status}&quot;)&#10;&#10;    return redirect(url_for(&quot;applying&quot;))&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;GET&quot;])&#10;@require_username&#10;def get_search_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    terms = [st.term for st in SearchTerm.select().where(SearchTerm.user == user)]&#10;    return jsonify(terms)&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def add_search_term():&#10;    term = request.form.get(&quot;term&quot;)&#10;    if not term:&#10;        return jsonify({&quot;error&quot;: &quot;No term provided&quot;}), 400&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    try:&#10;        SearchTerm.create(term=term, user=user)&#10;        return jsonify({&quot;success&quot;: True})&#10;    except Exception as e:&#10;        return jsonify({&quot;error&quot;: str(e)}), 400&#10;&#10;&#10;@app.route(&quot;/search_terms/&lt;term&gt;&quot;, methods=[&quot;DELETE&quot;])&#10;@require_username&#10;def delete_search_term(term):&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    q = SearchTerm.delete().where((SearchTerm.term == term) &amp; (SearchTerm.user == user))&#10;    deleted = q.execute()&#10;    return jsonify({&quot;deleted&quot;: deleted})&#10;&#10;&#10;@app.route(&quot;/manage_search_terms&quot;)&#10;@require_username&#10;def manage_search_terms():&#10;    return render_template(&quot;manage_search_terms.html&quot;)&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    serve(app, host=&quot;0.0.0.0&quot;, port=80)&#10;" />
              <option name="updatedContent" value="from flask import Flask, render_template, redirect, url_for, request, flash, session, jsonify&#10;from peewee import OperationalError&#10;from waitress import serve&#10;&#10;from model import Job, JobToListing, Listing, SearchTerm, User&#10;from sites.indeed import Indeed&#10;from sites.jora import Jora&#10;from sites.linkedin import LinkedIn&#10;from sites.seek import Seek&#10;&#10;app = Flask(__name__)&#10;app.secret_key = &quot;job_search_secret_key&quot;  # For flash messages&#10;&#10;&#10;# Helper to get current username from session&#10;def get_current_username():&#10;    username = session.get(&quot;username&quot;)&#10;    if not username:&#10;        return None&#10;    return username&#10;&#10;&#10;# Route to select/set username&#10;@app.route(&quot;/set_username&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])&#10;def set_username():&#10;    usernames = [u.username for u in User.select().order_by(User.username)]&#10;    if request.method == &quot;POST&quot;:&#10;        username = request.form.get(&quot;username&quot;)&#10;        if username and username in usernames:&#10;            session[&quot;username&quot;] = username&#10;            flash(f&quot;Username set to {username}&quot;)&#10;            return redirect(url_for(&quot;index&quot;))&#10;        else:&#10;            flash(&quot;Please select a valid username.&quot;)&#10;    return render_template(&quot;set_username.html&quot;, usernames=usernames)&#10;&#10;&#10;# Decorator to require username selection&#10;from functools import wraps&#10;&#10;&#10;def require_username(f):&#10;    @wraps(f)&#10;    def decorated_function(*args, **kwargs):&#10;        if not get_current_username():&#10;            return redirect(url_for(&quot;set_username&quot;))&#10;        return f(*args, **kwargs)&#10;&#10;    return decorated_function&#10;&#10;&#10;@app.route(&quot;/&quot;)&#10;@require_username&#10;def index():&#10;    &quot;&quot;&quot;Main page with workflow stages&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    triage_count = -1&#10;    while triage_count &lt; 0:&#10;        try:&#10;            triage_count = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).count()&#10;            reading_count = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).count()&#10;            applying_count = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).count()&#10;        except OperationalError:&#10;            print(&quot;Database error&quot;)&#10;&#10;    return render_template(&#10;        &quot;index.html&quot;,&#10;        triage_count=triage_count,&#10;        reading_count=reading_count,&#10;        applying_count=applying_count,&#10;        username=username,&#10;    )&#10;&#10;&#10;@app.route(&quot;/triage&quot;)&#10;@require_username&#10;def triage():&#10;    &quot;&quot;&quot;Triage page for new jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to triage&#10;    job = Job.select().where((Job.status == &quot;new&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to triage!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    return render_template(&quot;triage.html&quot;, job=job, listings=listings, username=username)&#10;&#10;&#10;@app.route(&quot;/triage/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def triage_action():&#10;    &quot;&quot;&quot;Handle triage actions (yes/no/undo)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;triage&quot;))&#10;&#10;    if action == &quot;interested&quot;:&#10;        job.status = &quot;interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for further review&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Skipped '{job.title}'&quot;)&#10;    elif action == &quot;undo&quot;:&#10;        # Get the most recently updated job that's not new&#10;        prev_job = (&#10;            Job.select().where((Job.status != &quot;new&quot;) &amp; (Job.username == username)).order_by(Job.id.desc()).first()&#10;        )&#10;        if prev_job:&#10;            prev_job.status = &quot;new&quot;&#10;            prev_job.save()&#10;            flash(f&quot;Undid action for '{prev_job.title}'&quot;)&#10;&#10;    return redirect(url_for(&quot;triage&quot;))&#10;&#10;&#10;@app.route(&quot;/reading&quot;)&#10;@require_username&#10;def reading():&#10;    &quot;&quot;&quot;Reading page for interested jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to read&#10;    job = Job.select().where((Job.status == &quot;interested&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to read!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;reading.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/reading/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def reading_action():&#10;    &quot;&quot;&quot;Handle reading actions (like/dislike)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    action = request.form.get(&quot;action&quot;)&#10;&#10;    if not job_id or not action:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    job = Job.get_or_none((Job.id == job_id) &amp; (Job.username == username))&#10;&#10;    if not job:&#10;        flash(&quot;Job not found or not yours.&quot;)&#10;        return redirect(url_for(&quot;reading&quot;))&#10;&#10;    if action == &quot;liked&quot;:&#10;        job.status = &quot;liked&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' for application&quot;)&#10;    elif action == &quot;not_interested&quot;:&#10;        job.status = &quot;not_interested&quot;&#10;        job.save()&#10;        flash(f&quot;Marked '{job.title}' as not a good fit&quot;)&#10;&#10;    return redirect(url_for(&quot;reading&quot;))&#10;&#10;&#10;@app.route(&quot;/applying&quot;)&#10;@require_username&#10;def applying():&#10;    &quot;&quot;&quot;Applying page for liked jobs&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    # Get the next job to apply for&#10;    job = Job.select().where((Job.status == &quot;liked&quot;) &amp; (Job.username == username)).first()&#10;&#10;    if not job:&#10;        flash(&quot;No more jobs to apply for!&quot;)&#10;        return redirect(url_for(&quot;index&quot;))&#10;&#10;    # Get listings for this job&#10;    listings = list(JobToListing.select().where(JobToListing.job_id == job.id).join(Listing).execute())&#10;&#10;    # Create site objects for links&#10;    sites = []&#10;    for listing in listings:&#10;        if listing.listing_id.site == &quot;seek&quot;:&#10;            sites.append((&quot;Seek&quot;, Seek.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;indeed&quot;:&#10;            sites.append((&quot;Indeed&quot;, Indeed.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;jora&quot;:&#10;            sites.append((&quot;Jora&quot;, Jora.get_url(listing.listing_id.id)))&#10;        elif listing.listing_id.site == &quot;linkedin&quot;:&#10;            sites.append((&quot;LinkedIn&quot;, LinkedIn.get_url(listing.listing_id.id)))&#10;&#10;    return render_template(&quot;applying.html&quot;, job=job, listings=listings, sites=sites, username=username)&#10;&#10;&#10;@app.route(&quot;/applying/action&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def applying_action():&#10;    &quot;&quot;&quot;Handle applying actions (status update)&quot;&quot;&quot;&#10;    username = get_current_username()&#10;    job_id = request.form.get(&quot;job_id&quot;)&#10;    status = request.form.get(&quot;status&quot;)&#10;&#10;    if not job_id or not status:&#10;        flash(&quot;Invalid request&quot;)&#10;        return redirect(url_for(&quot;applying&quot;))&#10;&#10;    job = Job.get_by_id(job_id)&#10;    job.status = status&#10;    job.save()&#10;    if status == &quot;applied&quot;:&#10;        flash(f&quot;Marked '{job.title}' as application submitted&quot;)&#10;    elif status == &quot;not_interested&quot;:&#10;        flash(f&quot;Marked '{job.title}' as not pursuing&quot;)&#10;    else:&#10;        flash(f&quot;Updated status for '{job.title}' to {status}&quot;)&#10;&#10;    return redirect(url_for(&quot;applying&quot;))&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;GET&quot;])&#10;@require_username&#10;def get_search_terms():&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    terms = [st.term for st in SearchTerm.select().where(SearchTerm.user == user)]&#10;    return jsonify(terms)&#10;&#10;&#10;@app.route(&quot;/search_terms&quot;, methods=[&quot;POST&quot;])&#10;@require_username&#10;def add_search_term():&#10;    term = request.form.get(&quot;term&quot;)&#10;    if not term:&#10;        return jsonify({&quot;error&quot;: &quot;No term provided&quot;}), 400&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    try:&#10;        SearchTerm.create(term=term, user=user)&#10;        return jsonify({&quot;success&quot;: True})&#10;    except Exception as e:&#10;        return jsonify({&quot;error&quot;: str(e)}), 400&#10;&#10;&#10;@app.route(&quot;/search_terms/&lt;term&gt;&quot;, methods=[&quot;DELETE&quot;])&#10;@require_username&#10;def delete_search_term(term):&#10;    username = get_current_username()&#10;    user = User.get(User.username == username)&#10;    q = SearchTerm.delete().where((SearchTerm.term == term) &amp; (SearchTerm.user == user))&#10;    deleted = q.execute()&#10;    return jsonify({&quot;deleted&quot;: deleted})&#10;&#10;&#10;@app.route(&quot;/manage_search_terms&quot;)&#10;@require_username&#10;def manage_search_terms():&#10;    return render_template(&quot;manage_search_terms.html&quot;)&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    serve(app, host=&quot;0.0.0.0&quot;, port=80)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/model.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/model.py" />
              <option name="originalContent" value="from peewee import (&#10;    Model,&#10;    AutoField,&#10;    CharField,&#10;    ForeignKeyField,&#10;    IntegerField,&#10;    CompositeKey,&#10;    TextField,&#10;    PostgresqlDatabase,&#10;)&#10;&#10;&#10;db = PostgresqlDatabase(&quot;job_search&quot;, user=&quot;josh&quot;, password=&quot;password&quot;, host=&quot;monitoring.lan&quot;)&#10;db.connect()&#10;&#10;&#10;class Job(Model):&#10;    id = AutoField(primary_key=True)&#10;    title = TextField()&#10;    company = TextField()&#10;    status = CharField(default=&quot;new&quot;)&#10;    username = CharField()  # New field for multi-user support&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class Listing(Model):&#10;    id = CharField(primary_key=True)&#10;    site = CharField()&#10;    summary = TextField()&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class JobToListing(Model):&#10;    job_id = ForeignKeyField(Job)&#10;    listing_id = ForeignKeyField(Listing)&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class PageCount(Model):&#10;    site = CharField()&#10;    query = CharField()&#10;    pages = IntegerField(default=1)&#10;&#10;    class Meta:&#10;        database = db&#10;        primary_key = CompositeKey(&quot;site&quot;, &quot;query&quot;)&#10;&#10;&#10;class SearchTerm(Model):&#10;    id = AutoField(primary_key=True)&#10;    term = CharField()  # Removed unique=True&#10;    user = ForeignKeyField(User, backref=&quot;search_terms&quot;)  # Attach to user&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class User(Model):&#10;    id = AutoField(primary_key=True)&#10;    username = CharField(unique=True)&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;db.create_tables([Job, Listing, JobToListing, PageCount, SearchTerm, User], safe=True)&#10;" />
              <option name="updatedContent" value="from peewee import (&#10;    Model,&#10;    AutoField,&#10;    CharField,&#10;    ForeignKeyField,&#10;    IntegerField,&#10;    CompositeKey,&#10;    TextField,&#10;    PostgresqlDatabase,&#10;)&#10;&#10;&#10;db = PostgresqlDatabase(&quot;job_search&quot;, user=&quot;josh&quot;, password=&quot;password&quot;, host=&quot;monitoring.lan&quot;)&#10;db.connect()&#10;&#10;&#10;class Job(Model):&#10;    id = AutoField(primary_key=True)&#10;    title = TextField()&#10;    company = TextField()&#10;    status = CharField(default=&quot;new&quot;)&#10;    username = CharField()  # New field for multi-user support&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class Listing(Model):&#10;    id = CharField(primary_key=True)&#10;    site = CharField()&#10;    summary = TextField()&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class JobToListing(Model):&#10;    job_id = ForeignKeyField(Job)&#10;    listing_id = ForeignKeyField(Listing)&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class PageCount(Model):&#10;    site = CharField()&#10;    query = CharField()&#10;    pages = IntegerField(default=1)&#10;&#10;    class Meta:&#10;        database = db&#10;        primary_key = CompositeKey(&quot;site&quot;, &quot;query&quot;)&#10;&#10;&#10;class SearchTerm(Model):&#10;    id = AutoField(primary_key=True)&#10;    term = CharField()  # Removed unique=True&#10;    user = ForeignKeyField(User, backref=&quot;search_terms&quot;)  # Attach to user&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;class User(Model):&#10;    id = AutoField(primary_key=True)&#10;    username = CharField(unique=True)&#10;&#10;    class Meta:&#10;        database = db&#10;&#10;&#10;db.create_tables([Job, Listing, JobToListing, PageCount, SearchTerm, User], safe=True)" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>