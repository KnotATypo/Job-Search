<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Blacklist Terms</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    {% extends "base.html" %}
    {% block content %}
    <div class="card search-terms-card">
        <h2>Manage Blacklist Terms</h2>
        <form id="add-term-form" class="add-term-form">
            <input type="text" id="new-term" class="term-input" placeholder="Add new blacklist term" required>
            <button type="submit" class="btn btn-success">Add</button>
        </form>
        <ul id="terms-list" class="terms-list"></ul>
        <button id="run-easy-filter" class="btn btn-primary" style="margin-top: 16px;">Run Easy Filter</button>
    </div>
    <script>
    function fetchTerms() {
        fetch('/blacklist_terms')
            .then(response => response.json())
            .then(terms => {
                const list = document.getElementById('terms-list');
                list.innerHTML = '';
                terms.forEach(term => {
                    const li = document.createElement('li');
                    li.className = 'term-list-item';
                    const span = document.createElement('span');
                    span.textContent = term;
                    li.appendChild(span);
                    const delBtn = document.createElement('button');
                    delBtn.textContent = 'Delete';
                    delBtn.className = 'btn btn-danger btn-delete';
                    delBtn.onclick = () => deleteTerm(term);
                    li.appendChild(delBtn);
                    list.appendChild(li);
                });
            });
    }
    function addTerm(e) {
        e.preventDefault();
        const term = document.getElementById('new-term').value;
        fetch('/blacklist_terms', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'term=' + encodeURIComponent(term)
        })
        .then(() => {
            document.getElementById('new-term').value = '';
            fetchTerms();
        });
    }
    function deleteTerm(term) {
        fetch('/blacklist_terms/' + encodeURIComponent(term), { method: 'DELETE' })
            .then(() => fetchTerms());
    }
    document.getElementById('add-term-form').addEventListener('submit', addTerm);
    window.onload = fetchTerms;

    document.getElementById('run-easy-filter').onclick = function() {
        fetch('/run_easy_filter', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ user_id: {{ user_id }} })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message || 'Easy filter run!');
        });
    };
    </script>
    {% endblock %}
</body>
</html>
