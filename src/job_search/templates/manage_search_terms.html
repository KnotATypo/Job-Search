{% extends "base.html" %}
{% block content %}
    <div class="card search-terms-card">
        <h2>Manage Search Terms</h2>
        <p id="toggle-help" class="toggle-help">Toggle the remote switch to only include remote jobs for that search
            term.</p>
        <form id="add-term-form" class="add-term-form">
            <label for="new-term" class="visually-hidden">New search term</label>
            <input type="text" id="new-term" class="term-input" placeholder="Add new search term" required>
            <button type="submit" class="btn btn-success">Add</button>
        </form>
        <ul id="terms-list" class="terms-list">
            {% for term in terms %}
                <li class="term-row">
                    <div class="term-left">
                        <div class="term-label">
                            <input type="checkbox" {% if term.remote %}checked{% endif %}
                                   title="Only include remote jobs for '{{ term.term }}' (currently {{ term.remote }})"
                                   class="term-checkbox" onchange="handleRemoteToggle({{ term.id }}, this)">
                            <span class="term-text">{{ term.term }}</span>
                            <button class="btn btn-danger btn-sm" onclick="deleteTerm({{ term.id }}, this)">Delete
                            </button>
                            {% if term.remote %}
                                <span class="remote-badge"
                                      title="This term will only return fully-remote roles (onsite/hybrid excluded)">REMOTE ONLY</span>
                            {% endif %}
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
        function handleRemoteToggle(term_id, checkbox) {
            checkbox.disabled = true;
            fetch('/search_terms/' + encodeURIComponent(term_id) + '/remote', {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({remote: checkbox.checked})
            })
                .then(() => {
                    location.reload();
                });
        }

        function addTerm(e) {
            e.preventDefault();
            const term = document.getElementById('new-term').value;
            fetch('/search_terms', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'term=' + encodeURIComponent(term)
            })
                .then(() => {
                    location.reload();
                });
        }

        function deleteTerm(term_id, btn) {
            if (!confirm('Delete this search term?')) return;
            btn.disabled = true;
            fetch('/search_terms/' + encodeURIComponent(term_id), {method: 'DELETE'})
                .then(() => {
                    location.reload();
                });
        }

        document.getElementById('add-term-form').addEventListener('submit', addTerm);
    </script>
{% endblock %}
